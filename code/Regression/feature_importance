import pandas as pd
import lightgbm as lgb

# Load the data
print("Loading data...")
df = pd.read_csv('data/filtered_dataset.csv')

# Define features and target
print("Preparing features and target...")
X = df.drop(['Label', 'LGD', 'EAD'], axis=1)  # Adjust columns as needed
y = df['LGD']  # Or 'EAD' depending on what you're predicting

# Initialize and fit LightGBM
print("Fitting LightGBM...")
lgb_model = lgb.LGBMRegressor(n_estimators=100, random_state=42)
lgb_model.fit(X, y)

# Get feature importance
feature_importance = pd.DataFrame({
    'feature': X.columns,
    'importance': lgb_model.feature_importances_
}).sort_values('importance', ascending=False)

# Display and save results
print("\nTop 10 features by LightGBM:")
print(feature_importance.head(10))

# Save results
feature_importance.to_csv('lgb_feature_importance.csv', index=False)
print("\nResults saved to 'lgb_feature_importance.csv'")